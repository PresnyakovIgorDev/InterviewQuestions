## **Семафоры**

Еще один инструмент, который предлагает нам платформа .NET для управления синхронизацией, представляют семафоры. 
Семафоры позволяют ограничить доступ определенным количеством объектов.

```c#
using` `System;
using` `System.Threading;
namespace` `SemaphoreApp
{
    ``class` `Program
    ``{
        ``static` `void` `Main(``string``[] args)
        ``{
            ``for` `(``int` `i = 1; i < 6; i++)
            ``{
                ``Reader reader = ``new` `Reader(i);
            ``}
            ``Console.ReadLine();
        ``}
    ``}
    ``class` `Reader
    ``{
        ``// создаем семафор
        ``static` `Semaphore sem = ``new` `Semaphore(3, 3);
        ``Thread myThread;
        ``int` `count = 3;``// счетчик чтения
        
        ``public` `Reader(``int` `i)
        ``{
            ``myThread = ``new` `Thread(Read);
            ``myThread.Name = ``"Читатель "` `+ i.ToString();
            ``myThread.Start();
        ``}
        ``public` `void` `Read()
        ``{
            ``while` `(count > 0)
            ``{
                ``sem.WaitOne();
                ``Console.WriteLine(``"{0} входит в библиотеку"``, Thread.CurrentThread.Name);
                ``Console.WriteLine(``"{0} читает"``, Thread.CurrentThread.Name);
                ``Thread.Sleep(1000);
                ``Console.WriteLine(``"{0} покидает библиотеку"``, Thread.CurrentThread.Name);
                ``sem.Release();
                ``count--;
                ``Thread.Sleep(1000);
            ``}
        ``}
    ``}
}
```

В данной программе читатель представлен классом Reader. Он  инкапсулирует всю функциональность, связанную с потоками, через  переменную  `Thread myThread`.

Для создания семафора используется класс Semaphore: `static Semaphore sem = new Semaphore(3, 3);`.   Его конструктор принимает два параметра: первый указывает, какому числу  объектов изначально будет доступен семафор, а второй параметр указывает,   какой максимальное число объектов будет использовать данный семафор. В  данном случае у нас только три читателя могут одновременно находиться  в библиотеке, поэтому максимальное число равно 3.

Основной функционал сосредоточен в методе `Read`, который и выполняется в потоке. В начале для ожидания получения семафора  используется метод `sem.WaitOne()`. После того, как в  семафоре освободится место, данный поток заполняет свободное место и  начинает выполнять все дальнейшие действия.  После окончания чтения мы высвобождаем семафор с помощью метода `sem.Release()`. После этого в семафоре освобождается одно место,  которое заполняет другой поток.